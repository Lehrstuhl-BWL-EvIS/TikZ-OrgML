\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[ngerman]{babel}
\usepackage{blindtext}

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ Laden von TikZ
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\usepackage{tikz}


%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~  __  __ ___ __  __  ___     ___           __  __ _    
%~~ |  \/  | __|  \/  |/ _ \   / _ \ _ _ __ _|  \/  | |   
%~~ | |\/| | _|| |\/| | (_) | | (_) | '_/ _` | |\/| | |__ 
%~~ |_|  |_|___|_|  |_|\___/   \___/|_| \__, |_|  |_|____|
%~~                                     |___/             
%~~  ___ _                      
%~~ / __| |_  __ _ _ __  ___ ___
%~~ \__ \ ' \/ _` | '_ \/ -_|_-<
%~~ |___/_||_\__,_| .__/\___/__/
%~~               |_|   
%~~
%~~ Definition der MEMO OrgML Notationssymbole als Shapes für TikZ Nodes
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ Pakete
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\usepackage{xstring}

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ Farben
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\definecolor{event}{RGB}{198,212,220}
\definecolor{startevent}{RGB}{162,180,0}
\definecolor{endevent}{RGB}{200,0,52}

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ TikZ-Styles
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ ToDo Größe der Shapes dynamisch berechnen?

%~~ Events
\tikzset{
    event/.style={
        draw,
        inner sep=3ex,
        color=event
    }
}

\tikzset{
    startevent/.style={
        event,
        color=startevent
    }
}

\tikzset{
    endevent/.style={
        event,
        color=endevent
    }
}

\tikzset{
    msgevent/.style={
        event
    }
}

%~~ Prozesse
\tikzset{
    unspecprocess/.style={
        draw,
        inner sep=2.5ex,
        text width=5em
    }
}

%~~ Textnodes
\tikzset{
    memotext/.style={
        below,
        align=center,
        font=\footnotesize\sffamily        
    }
}

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ Definition der MEMO OrgML-Shapes
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\makeatletter

%~~ EREIGNISSE

%~~ Basisereignis
\pgfdeclareshape{event}{
    %~~ Übernahme der Anchor aus dem standard Rechteck
    %~~ Shape
    \inheritsavedanchors[from=rectangle]  	        
	\inheritanchorborder[from=rectangle] 
	\inheritanchor[from=rectangle]{center} 
	\inheritanchor[from=rectangle]{north}
 	\inheritanchor[from=rectangle]{south} 
	\inheritanchor[from=rectangle]{west} 
	\inheritanchor[from=rectangle]{east}

    
    %~~ Hintergrundpfad des Basisereignisses       
	\backgroundpath{
        %~~ Speichern der Werte der Anker in den 
        %~~ temporären PGF Registern xa,ya und xb und yb
	    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
	    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
			    
									
        %~~ Erzeugen der äußeren Kanten des Notationssymbols
        %~~ mit Hilfe eines Path (Dreieck}
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@yb}}   
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb*0.1}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
    	    	    			
    	%~~ Setzen der Farbe
    	\pgfusepath{stroke} 	
    			
    	%~~ Abschluss des Pfades   		
    	\pgfpathclose  	    				
    }
}

%~~ Bezeichner für spezielle Ereignisse:
%~~ ?????event, z.B. startevent, endevent, etc.

%~~ Startereignis
\pgfdeclareshape{startevent}{
    %~~ Die Anchor werden aus dem Basisshape für Events
    %~~ geerbt
	\inheritsavedanchors[from=event]  	        
	\inheritanchorborder[from=event] 
	\inheritanchor[from=event]{center} 
	\inheritanchor[from=event]{north}
 	\inheritanchor[from=event]{south} 
	\inheritanchor[from=event]{west} 
	\inheritanchor[from=event]{east}
	
	
	%~~ Erben des Hintergrundpfades aus dem Basisshape
	%~~ für Events
	\inheritbackgroundpath[from=event]
	
	%~~ Erzeugen des Textes "START" überhalb des Events
	\beforebackgroundpath{
	    %~~ Speichern der Werte der Anker in den 
        %~~ temporären PGF Registern xa,ya und xb und yb
	    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
	    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
	
	    %~~ Erzeugen des Textes über dem Dreieck
	    %~~ Die Positionierung erfolgt dabei relativ zu den Ankern
    	\pgftext[left, x=\pgf@xb*-.2, y=\pgf@yb*1.25]{\textsf{\fontsize{1}{5}\selectfont START}}
	}
}

\pgfdeclareshape{endevent}{
    %~~ Die Anchor werden aus dem Basisshape für Events
    %~~ geerbt
	\inheritsavedanchors[from=event]  	        
	\inheritanchorborder[from=event] 
	\inheritanchor[from=event]{center} 
	\inheritanchor[from=event]{north}
 	\inheritanchor[from=event]{south} 
	\inheritanchor[from=event]{west} 
	\inheritanchor[from=event]{east}
	
	
	%~~ Erben des Hintergrundpfades aus dem Basisshape
	%~~ für Events
	\inheritbackgroundpath[from=event]
	
	%~~ Erzeugen des Textes "STOP" überhalb des Events
	\beforebackgroundpath{
	    %~~ Speichern der Werte der Anker in den 
        %~~ temporären PGF Registern xa,ya und xb und yb
	    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
	    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
	
	    %~~ Erzeugen des Textes über dem Dreieck
	    %~~ Die Positionierung erfolgt dabei relativ zu den Ankern
    	\pgftext[left, x=\pgf@xb*-.1, y=\pgf@yb*1.25]{\textsf{\fontsize{1}{5}\selectfont STOP}}
	}
}

\pgfdeclareshape{msgevent}{
    %~~ Die Anchor werden aus dem Basisshape für Events
    %~~ geerbt
	\inheritsavedanchors[from=event]  	        
	\inheritanchorborder[from=event] 
	\inheritanchor[from=event]{center} 
	\inheritanchor[from=event]{north}
 	\inheritanchor[from=event]{south} 
	\inheritanchor[from=event]{west} 
	\inheritanchor[from=event]{east}
	
	
	%~~ Erben des Hintergrundpfades aus dem Basisshape
	%~~ für Events
	\inheritbackgroundpath[from=event]
	
	%~~ Erzeugen des Briefumschlages 
	\beforebackgroundpath{
	    %~~ Speichern der Werte der Anker in den 
        %~~ temporären PGF Registern xa,ya und xb und yb
	    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
	    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    	
    	%~~ Definition der Farben für den Briefumschlag und
    	%~~ den Hintergrund
    	\definecolor{black}{RGB}{20,18,21}
    	\pgfsetcolor{black}
    	%~~ Hintergrund
    	\pgfsetfillcolor{white}
    	
    	%~~ Rahmen für den Briefumschlag
    	\begin{pgfscope}
    	    %~~ Die äußere Linienstärke wird innerhalb des Scope
    	    %~~ definiert
    	    \pgfsetlinewidth{0.75pt}
    	    \pgfpathmoveto{\pgfpoint{\pgf@xb*-0.75}{\pgf@yb*0.75}}   
            \pgfpathlineto{\pgfpoint{\pgf@xb*0.75}{\pgf@yb*0.75}}
            \pgfpathlineto{\pgfpoint{\pgf@xb*0.75}{\pgf@yb*-0.35}}
            \pgfpathlineto{\pgfpoint{\pgf@xb*-0.75}{\pgf@yb*-0.35}}
            \pgfpathlineto{\pgfpoint{\pgf@xb*-0.75}{\pgf@yb*0.75}}
            \pgfusepath{stroke,fill}
        \end{pgfscope}
        
        %~~ Faltkanten des Briefumschlges
	    \pgfpathmoveto{\pgfpoint{\pgf@xb*-0.75}{\pgf@yb*0.75}}
	    \pgfpathlineto{\pgfpoint{\pgf@xb*0}{\pgf@yb*0.15}}
	    \pgfpathlineto{\pgfpoint{\pgf@xb*0.75}{\pgf@yb*0.75}}
	    
	    \pgfpathmoveto{\pgfpoint{\pgf@xb*-0.75}{\pgf@yb*-0.35}}
	    \pgfpathlineto{\pgfpoint{\pgf@xb*-0.15}{\pgf@yb*0.25}}
	    
	    \pgfpathmoveto{\pgfpoint{\pgf@xb*0.75}{\pgf@yb*-0.35}}
	    \pgfpathlineto{\pgfpoint{\pgf@xb*0.15}{\pgf@yb*0.25}}        
	    
    	\pgfusepath{stroke}
    	
    	\pgfpathclose
	}
}


%~~ PROZESSE

%~~ Unspezifizierter Prozess
\pgfdeclareshape{unspecprocess}{
    %ToDo Anpassung der Kommentare

    %~~ Übernahme der Anchors aus dem
    %~~ Rechteck
	\inheritsavedanchors[from=rectangle]  	        
	\inheritanchorborder[from=rectangle] 
	\inheritanchor[from=rectangle]{center} 
	\inheritanchor[from=rectangle]{north}
 	\inheritanchor[from=rectangle]{south} 
	\inheritanchor[from=rectangle]{west} 
	\inheritanchor[from=rectangle]{east}
    
    \renewcommand{\fontfamily}{\sffamily}
    
    % ToDo Kommentare anpassen

	% Pfad hinter dem Text
	\backgroundpath{
        % store lower right in xa/ya and upper right in xb/yb
    			
    	% !ACHTUNG! Zuweisung wie bei einer Variablen
    	% \southwest = ...
    	% \northeast = ...
		\southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
		\northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
				
		%~~ Definition der Farbe für die Linien und
		%~~ den Hintergrund des Shapes
		\definecolor{background}{RGB}{198,212,220}
		\pgfsetcolor{background}
				
    	%# Step 01
    	% Startpunkt
    	% \pgfpoint = Punkt bzw. Koordinate   
    	\pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    			
    	%# Step 02
    	%
    	\pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
    			
    	%# Step 03
    	% 
    	\pgfpathlineto{\pgfpoint{\pgf@xb*0.75}{\pgf@yb}}
    			  			
    			
    	%# Step 05
    	%
    	\pgfpathlineto{\pgfpoint{\pgf@xb}{0}}
    			
    	%# Step 06
    	%
    	\pgfpathlineto{\pgfpoint{\pgf@xb*0.75}{\pgf@ya}}
    		
    	%Setzen der Farbe
    	\pgfusepath{fill,stroke}
    			
    	% Abschluss des Pfades   		
    	\pgfpathclose  	    			
 	}
}

\makeatother

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
%~~ LaTeX-Macros
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
% Macroname: \memonode
% Funktion:  Erzeugen eines MEMO OrgML Notationssymbols mit dem passenden
%            Shape, an der definierten Stelle mit dem definierten Text
% Parameter: #1: Name des zu verwendenden Shapes
%            #2: Name des Nodes der erzeugt wird
%            #3: x-Position
%            #4: y-Position
%            #5: Beschreibung des Ereignisses/Prozesses
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
\newcommand{\memonode}[5]{
    %~~ Erzeugen des Nodes der das Notationssymbol darstellt.
    %~~ Die Verwendung des richtigen Styles wird durch die Namensgleichheit
    %~~ des Styles und des Shapes erreicht.
    \node[#1, shape=#1] (#2) at (#3,#4) {};
        
    %~~ Erzeugen des Textes (Node) unterhalb des Notationssymbol der
    %~~ das Ereignis bzw. den Prozess beschreibt
    \node[memotext] at (#2.south) {#5};
}


%~~ Ende des Erweiterungspaketes



\begin{document}

%\blindtext\bigskip

%ToDo Anpassung der Übergänge (Transitions)

%~~ TikZ Bild
\begin{tikzpicture}[scale=0.85]
    %~~ Beispiel Prozess 
    \memonode{startevent}{x}{0}{0}{Anfrage \\ genehmigt};
       
    \memonode{unspecprocess}{y}{4}{3}{Logistikkosten berechnen};    
    
    \memonode{msgevent}{k}{8}{3}{Logistikkossten berechnet};
    
    \memonode{unspecprocess}{l}{12}{3}{Logistikkosten bewerten};
          
    \memonode{endevent}{z}{13}{0}{Bestellung \\ zusammengestellt};
    
    %~~ Einfache Verbindung zwischen des Shapes 
    \draw (x) -- (y);
    \draw (y) -- (k);
    \draw (k) -- (l);
    \draw (l) -- (z);
\end{tikzpicture}

%\blindtext
\end{document}
